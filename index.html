<!DOCTYPE html>
<html>
	<head>
		<title>Draggable</title>
		<meta charset="UTF-8" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		<script  src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js"   integrity="sha256-xI/qyl9vpwWFOXz7+x/9WkG5j/SVnSw21viy8fWwbeE="   crossorigin="anonymous"></script>
		<link rel="stylesheet" type="text/css" href="draggable.css">
	</head>
	
	<body>
		<main id="main"></main>
		<section id="msgs"></section>
		
		<script>
		var id = 0;
			$(document).ready(function(){
				$("main").click(function(event){
					var div = document.createElement('div');
					div.className = "draggable";
					div.id  = id.toString();
					div.innerHTML = "Type some text here!";
					document.getElementById("msgs").appendChild(div, document.body.firstChild);
					$( "#" + id.toString() ).css({
																'top' : (event.pageY.toString() + "px"), 
																'left' : (event.pageX.toString() + "px"), 
																});
					$( "#" + id.toString() ).attr("data-status", "text");
					$( "#" + id.toString() ).draggable().dblclick(function(event){
						if($("#" + event.target.id).attr("data-status") == "input")
							return;
						var txt = event.target.innerHTML;
						event.target.innerHTML = "<input type='text' data-text='" + txt + "' data-parent='" + event.target.id + "' onkeydown='toText(event)' value ='" + txt + "'>";
						$("#" + event.target.id).attr("data-status" , "input");
						$( "input[data-parent='" + event.target.id + "']" ).focus();
						$( "input[data-parent='" + event.target.id + "']" ).setCursorToTextEnd();
					});
					id++;
				});

			});
			
			(function($){
				$.fn.setCursorToTextEnd = function() {
					var $initialVal = this.val();
					this.val($initialVal);
				};
			})(jQuery);
			
			function toText(event){
					if( $(event.target).val() == "" ){
						$("#" + $(event.target).attr("data-parent") ).remove();
						return;
					}
					if(event.keyCode == 13){
						$("#" + $(event.target).attr("data-parent") ).html( $(event.target).val() );
						$("#" + $(event.target).attr("data-parent") ).attr("data-status", "text");
					}
					else if(event.keyCode == 27){
						$("#" + $(event.target).attr("data-parent") ).html( $(event.target).attr("data-text") );
						$("#" + $(event.target).attr("data-parent") ).attr("data-status", "text");
					}
				}
		</script>
		
	</body>
</html>
			